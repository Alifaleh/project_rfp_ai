<odoo>
    <!-- GLOBAL RFP THEME STYLES -->
    <template id="rfp_theme_styles" name="RFP Theme Styles">
        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com"/>
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
        
        <style>
            /* === RFP GOLD THEME === */
            :root {
                --rfp-gold: #C9A227;
                --rfp-gold-light: #F5ECD7;
                --rfp-gold-dark: #8B6914;
                --rfp-gold-gradient: linear-gradient(135deg, #C9A227 0%, #E8D48B 50%, #C9A227 100%);
                --rfp-dark: #1A1A2E;
                --rfp-gray: #4A5568;
                --rfp-light: #F8F9FA;
                --rfp-white: #FFFFFF;
                --rfp-shadow: 0 4px 20px rgba(0,0,0,0.08);
                --rfp-shadow-hover: 0 8px 30px rgba(0,0,0,0.12);
                --rfp-radius: 12px;
                --rfp-radius-sm: 8px;
            }
            
            /* Typography - exclude FontAwesome icons */
            .rfp-portal-wrapper,
            .rfp-portal-wrapper *:not(.fa):not([class*="fa-"]) {
                font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif !important;
            }
            
            .rfp-portal-wrapper h1, .rfp-portal-wrapper h2, .rfp-portal-wrapper h3,
            .rfp-portal-wrapper h4, .rfp-portal-wrapper h5, .rfp-portal-wrapper h6 {
                color: var(--rfp-dark);
                font-weight: 600;
            }
            
            .rfp-portal-wrapper p, .rfp-portal-wrapper span, .rfp-portal-wrapper label {
                color: var(--rfp-gray);
            }
            
            /* Gold Button */
            .btn-rfp-gold {
                background: var(--rfp-gold-gradient);
                border: none;
                color: var(--rfp-dark) !important;
                font-weight: 600;
                padding: 0.625rem 1.5rem;
                border-radius: var(--rfp-radius-sm);
                box-shadow: 0 2px 8px rgba(201, 162, 39, 0.3);
                transition: all 0.3s ease;
            }
            .btn-rfp-gold:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 16px rgba(201, 162, 39, 0.4);
                color: var(--rfp-dark) !important;
            }
            .btn-rfp-gold:active {
                transform: translateY(0);
            }
            
            /* Gold Outline Button */
            .btn-rfp-gold-outline {
                background: transparent;
                border: 2px solid var(--rfp-gold);
                color: var(--rfp-gold) !important;
                font-weight: 600;
                padding: 0.5rem 1.25rem;
                border-radius: var(--rfp-radius-sm);
                transition: all 0.3s ease;
            }
            .btn-rfp-gold-outline:hover {
                background: var(--rfp-gold);
                color: var(--rfp-dark) !important;
            }
            
            /* Override Bootstrap Primary with Gold */
            .rfp-portal-wrapper .btn-primary {
                background: var(--rfp-gold-gradient) !important;
                border: none !important;
                color: var(--rfp-dark) !important;
                font-weight: 600;
            }
            .rfp-portal-wrapper .btn-primary:hover {
                box-shadow: 0 4px 16px rgba(201, 162, 39, 0.4);
            }
            
            .rfp-portal-wrapper .btn-outline-primary {
                border-color: var(--rfp-gold) !important;
                color: var(--rfp-gold) !important;
            }
            .rfp-portal-wrapper .btn-outline-primary:hover {
                background: var(--rfp-gold) !important;
                color: var(--rfp-dark) !important;
            }
            
            /* Cards */
            .rfp-portal-wrapper .card {
                border: none;
                border-radius: var(--rfp-radius);
                box-shadow: var(--rfp-shadow);
                transition: all 0.3s ease;
            }
            .rfp-portal-wrapper .card:hover {
                box-shadow: var(--rfp-shadow-hover);
            }
            
            /* Section Cards with Gold Accent */
            .rfp-portal-wrapper .rfp-section-block {
                border-left: 4px solid var(--rfp-gold) !important;
                border-radius: var(--rfp-radius) !important;
            }
            
            /* Form Inputs */
            .rfp-portal-wrapper .form-control:focus,
            .rfp-portal-wrapper .form-select:focus {
                border-color: var(--rfp-gold);
                box-shadow: 0 0 0 3px rgba(201, 162, 39, 0.15);
            }
            
            /* Progress Bar */
            .rfp-portal-wrapper .progress {
                background: var(--rfp-gold-light);
                border-radius: 50px;
                overflow: hidden;
            }
            .rfp-portal-wrapper .progress-bar {
                background: var(--rfp-gold-gradient) !important;
                color: var(--rfp-dark) !important;
                font-weight: 600;
            }
            
            /* Badges - only override primary, keep success green */
            .rfp-portal-wrapper .badge.bg-primary {
                background: var(--rfp-gold) !important;
                color: var(--rfp-dark) !important;
            }
            /* Gold badge utility class */
            .rfp-portal-wrapper .badge.bg-rfp-gold {
                background: var(--rfp-gold) !important;
                color: var(--rfp-dark) !important;
            }
            
            /* Spinner */
            .rfp-portal-wrapper .spinner-border.text-primary {
                color: var(--rfp-gold) !important;
            }
            
            /* Loading Overlay */
            #rfp_loading_overlay .spinner-border {
                color: var(--rfp-gold) !important;
            }
            #rfp_loading_overlay h4 {
                color: var(--rfp-dark) !important;
            }
            
            /* Toolbar */
            .rfp-toolbar {
                background: var(--rfp-white);
                border-radius: var(--rfp-radius);
                box-shadow: var(--rfp-shadow);
                border-bottom: 3px solid var(--rfp-gold);
            }
            
            /* Modal Headers */
            .rfp-portal-wrapper .modal-header {
                border-bottom: 2px solid var(--rfp-gold-light);
            }
            
            /* Alert Info */
            .rfp-portal-wrapper .alert-info {
                background: var(--rfp-gold-light);
                border-color: var(--rfp-gold);
                color: var(--rfp-dark);
            }
            
            /* Text Utilities */
            .text-rfp-gold { color: var(--rfp-gold) !important; }
            .bg-rfp-gold { background: var(--rfp-gold) !important; }
            .bg-rfp-gold-light { background: var(--rfp-gold-light) !important; }
            
            /* Page Hero Section */
            .rfp-hero {
                background: linear-gradient(135deg, var(--rfp-dark) 0%, #2D2D4A 100%);
                color: var(--rfp-white);
                padding: 2.5rem 2rem;
                border-radius: var(--rfp-radius);
                margin-bottom: 2rem;
                position: relative;
                overflow: hidden;
            }
            .rfp-hero::before {
                content: '';
                position: absolute;
                top: -50%;
                right: -20%;
                width: 400px;
                height: 400px;
                background: radial-gradient(circle, rgba(201, 162, 39, 0.3) 0%, transparent 70%);
                border-radius: 50%;
            }
            .rfp-hero h1, .rfp-hero h2, .rfp-hero h3 {
                color: var(--rfp-white);
                position: relative;
                z-index: 1;
            }
            .rfp-hero p {
                color: rgba(255,255,255,0.8);
                position: relative;
                z-index: 1;
            }
            
            /* Project Cards */
            .rfp-project-card {
                background: var(--rfp-white);
                border-radius: var(--rfp-radius);
                padding: 1.5rem;
                box-shadow: var(--rfp-shadow);
                transition: all 0.3s ease;
                border-left: 4px solid var(--rfp-gold);
            }
            .rfp-project-card:hover {
                transform: translateY(-4px);
                box-shadow: var(--rfp-shadow-hover);
            }
            
            /* Diagram Cards */
            .rfp-portal-wrapper .diagram-card {
                border-radius: var(--rfp-radius-sm) !important;
                overflow: hidden;
            }
            .rfp-portal-wrapper .diagram-card img {
                transition: transform 0.3s ease;
            }
            .rfp-portal-wrapper .diagram-card:hover img {
                transform: scale(1.05);
            }
            
            /* Add Section Button */
            .rfp-portal-wrapper .dashed-border {
                border: 2px dashed var(--rfp-gold) !important;
                border-radius: var(--rfp-radius);
                color: var(--rfp-gold);
                transition: all 0.3s ease;
            }
            .rfp-portal-wrapper .dashed-border:hover {
                background: var(--rfp-gold-light);
                color: var(--rfp-dark);
            }
        </style>
    </template>
    
    <!-- Tile template removed as we are overriding the home page -->

    <template id="portal_breadcrumbs_rfp" inherit_id="portal.portal_breadcrumbs" priority="30">
        <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
            <li t-if="page_name == 'rfp_interface'" class="breadcrumb-item">
                <a href="/my">Projects</a>
            </li>
            <li t-if="page_name == 'rfp_interface'" class="breadcrumb-item active">
                <span t-field="rfp_project.name"/>
            </li>
        </xpath>
    </template>

    <!-- NEW COMPONENT: Loading Overlay -->
    <template id="rfp_loading_overlay_component" name="RFP Loading Overlay">
        <div id="rfp_loading_overlay" class="d-none position-fixed top-0 start-0 w-100 h-100 bg-white bg-opacity-75 d-flex justify-content-center align-items-center" style="z-index: 1050; backdrop-filter: blur(2px);">
            <div class="text-center">
                <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h4 class="mt-3 text-primary">AI Analyst is thinking...</h4>
                <p class="text-muted small">Please do not refresh the page.</p>
            </div>
        </div>
    </template>

    <template id="portal_my_rfps" name="My RFPs">
        <t t-call="portal.portal_layout">
            <t t-call="project_rfp_ai.rfp_theme_styles"/>
            <t t-set="breadcrumbs_searchbar" t-value="True"/>

            <div class="container rfp-portal-wrapper py-4">
                <!-- Hero Section -->
                <div class="rfp-hero mb-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h2 class="mb-2">My RFP Projects</h2>
                            <p class="mb-0">Create and manage your AI-powered Request for Proposals</p>
                        </div>
                        <div class="col-md-4 text-md-end mt-3 mt-md-0">
                            <a href="/rfp/start" class="btn btn-rfp-gold btn-lg">
                                <i class="fa fa-plus me-2"/> Start New Project
                            </a>
                        </div>
                    </div>
                </div>

                <t t-if="not projects">
                    <div class="text-center py-5">
                        <i class="fa fa-folder-open-o fa-4x text-muted mb-3" style="opacity: 0.3;"/>
                        <h4 class="text-muted">No projects yet</h4>
                        <p class="text-muted">Start your first AI-powered RFP project</p>
                        <a href="/rfp/start" class="btn btn-rfp-gold mt-2">
                            <i class="fa fa-rocket me-2"/> Create First Project
                        </a>
                    </div>
                </t>
                <t t-if="projects">
                    <div class="row g-4">
                        <t t-foreach="projects" t-as="project">
                            <div class="col-md-6 col-lg-4">
                                <div class="rfp-project-card h-100">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h5 class="mb-0 text-rfp-gold" t-field="project.name"/>
                                        <span class="badge bg-rfp-gold rounded-pill" t-field="project.current_stage"/>
                                    </div>
                                    <p class="text-muted small mb-3 text-truncate" style="max-height: 40px;" t-field="project.description"/>
                                    <a t-attf-href="/rfp/interface/#{project.id}" class="btn btn-rfp-gold-outline btn-sm w-100">
                                        <i class="fa fa-arrow-right me-1"/> Continue
                                    </a>
                                </div>
                            </div>
                        </t>
                    </div>
                </t>
            </div>
        </t>
    </template>

    <template id="portal_rfp_start" name="Start RFP Wizard">
        <t t-call="portal.portal_layout">
            <t t-call="project_rfp_ai.rfp_theme_styles"/>
            <div class="container rfp-portal-wrapper py-5">
                <t t-call="project_rfp_ai.rfp_loading_overlay_component"/>
                
                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-6">
                        <div class="card shadow-lg border-0">
                            <div class="card-body p-4 p-md-5">
                                <!-- Header -->
                                <div class="text-center mb-4">
                                    <div class="mb-3">
                                        <i class="fa fa-rocket fa-3x text-rfp-gold"/>
                                    </div>
                                    <h2 class="mb-2">Start New Project</h2>
                                    <p class="text-muted">Describe your idea and let AI guide you through the requirements gathering</p>
                                </div>
                                
                                <hr class="my-4" style="border-color: var(--rfp-gold-light);"/>
                                
                                <form action="/rfp/init" method="post">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    
                                    <div class="mb-4">
                                        <label class="form-label fw-semibold">Project Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" class="form-control form-control-lg" placeholder="e.g., E-Commerce Platform RFP" required="required"/>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <label class="form-label fw-semibold">Initial Description <span class="text-danger">*</span></label>
                                        <textarea name="description" class="form-control" rows="5" placeholder="Describe your project goals, key features, and any specific requirements..." required="required"/>
                                        <small class="text-muted">Our AI will analyze this and guide you through detailed questions</small>
                                    </div>

                                    <div class="d-grid">
                                        <button type="submit" class="btn btn-rfp-gold btn-lg">
                                            <i class="fa fa-magic me-2"/> Start AI Analysis
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>




    <template id="portal_rfp_input_field" name="RFP Input Field Component">
        <div
            class="mb-4 p-3 border rounded bg-light rfp-input-group position-relative" t-att-id="'input_group_' + input_field.field_key" t-att-data-field-key="input_field.field_key" t-att-data-depends-on="input_field.depends_on or '{}'" t-att-data-specify-triggers="input_field.specify_triggers or '[]'">

            <!-- Header: Label + Options Menu -->
            <div class="d-flex justify-content-between align-items-start mb-2">
                <label class="form-label fw-bold mb-0 text-dark flex-grow-1 me-3 text-wrap" style="word-break: break-word;">
                    <t t-esc="input_field.label"/>
                </label>

                <!-- Three Dots Menu -->
                <div class="dropdown">
                    <button class="btn btn-link text-decoration-none text-muted p-0" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fa fa-ellipsis-v fa-lg"/>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li>
                            <a class="dropdown-item text-primary btn-custom-answer-toggle" href="#" t-att-data-target="'custom_answer_' + input_field.field_key" t-if="input_field.component_type not in ['text_input', 'textarea', 'number_input']">
                                <i class="fa fa-pencil me-2"/>Custom Answer
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item text-danger btn-irrelevant-toggle" href="#" t-att-data-target="'irrelevant_' + input_field.field_key">
                                <i class="fa fa-ban me-2"/>Skip Question
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <p class="text-muted small" t-if="input_field.data_type"><t t-esc="input_field.description_tooltip or ''"/></p>

            <!-- Dynamic Rendering Switch -->
            <t t-if="input_field.component_type == 'text_input'">
                <input type="text" t-att-name="input_field.field_key" class="form-control"/>
            </t>

            <t t-elif="input_field.component_type == 'number_input'">
                <input type="number" t-att-name="input_field.field_key" class="form-control"/>
            </t>

            <t t-elif="input_field.component_type == 'textarea'">
                <textarea t-att-name="input_field.field_key" class="form-control" rows="3"></textarea>
            </t>

            <t t-elif="input_field.component_type == 'select'">
                <select t-att-name="input_field.field_key" class="form-select">
                    <option value="">Select...</option>
                    <t t-if="input_field.get_options_parsed()">
                        <t t-foreach="input_field.get_options_parsed()" t-as="opt">
                            <t t-if="isinstance(opt, dict)">
                                <option t-att-value="opt['value']"><t t-esc="opt['label']"/></option>
                            </t>
                            <t t-else="">
                                <option t-att-value="opt"><t t-esc="opt"/></option>
                            </t>
                        </t>
                    </t>
                </select>
            </t>

            <t t-elif="input_field.component_type == 'multiselect'">
                <div class="mb-2">
                    <small class="text-muted">Select all that apply:</small>
                    <t t-if="input_field.get_options_parsed()">
                        <t t-foreach="input_field.get_options_parsed()" t-as="opt">
                             <t t-set="opt_val" t-value="opt['value'] if isinstance(opt, dict) else opt"/>
                             <t t-set="opt_label" t-value="opt['label'] if isinstance(opt, dict) else opt"/>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" t-att-name="input_field.field_key" t-att-value="opt_val"/>
                                <label class="form-check-label"><t t-esc="opt_label"/></label>
                            </div>
                        </t>
                    </t>
                </div>
                <!-- Specify Input (Hidden by default) -->
                <input type="text" t-att-name="input_field.field_key + '_specify'" class="form-control mt-2 rfp-specify-input d-none" placeholder="Please specify..."/>
            </t>

            <t t-elif="input_field.component_type == 'radio'">
                <div class="rfp-radio-group">
                    <t t-if="input_field.get_options_parsed()">
                        <t t-foreach="input_field.get_options_parsed()" t-as="opt" t-as-index="opt_index">
                            <t t-set="opt_val" t-value="opt['value'] if isinstance(opt, dict) else opt"/>
                            <t t-set="opt_label" t-value="opt['label'] if isinstance(opt, dict) else opt"/>
                            <div class="form-check">
                                <input class="form-check-input rfp-dynamic-input" type="radio" t-att-name="input_field.field_key" t-att-id="input_field.field_key + '_' + str(opt_index)" t-att-value="opt_val" t-att-required="input_field.depends_on == '{}' or ''"/>
                                <label class="form-check-label" t-att-for="input_field.field_key + '_' + str(opt_index)">
                                    <t t-esc="opt_label"/>
                                </label>
                            </div>
                        </t>
                    </t>
                </div>
                <!-- Specify Input (Hidden by default) -->
                <input type="text" t-att-name="input_field.field_key + '_specify'" class="form-control mt-2 rfp-specify-input d-none" placeholder="Please specify..."/>
            </t>

            <t t-elif="input_field.component_type == 'boolean'">
                <div class="d-flex gap-4">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" t-att-name="input_field.field_key" value="yes" t-att-id="input_field.field_key + '_yes'"/>
                        <label class="form-check-label" t-att-for="input_field.field_key + '_yes'">
                            Yes
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" t-att-name="input_field.field_key" value="no" t-att-id="input_field.field_key + '_no'"/>
                        <label class="form-check-label" t-att-for="input_field.field_key + '_no'">
                            No
                        </label>
                    </div>
                </div>
            </t>

            <!-- Suggested Answers (Text/Textarea Only) -->
            <!-- Wrapped lines enabled with text-wrap and lh-sm classes -->
            <t t-if="input_field.get_suggested_answers_parsed() and input_field.component_type in ['text_input', 'textarea']">
                <div class="mt-2 mb-2">
                    <small class="text-muted d-block mb-1">AI Suggestions (Click to fill):</small>
                    <div class="d-flex flex-column gap-2">
                        <t t-foreach="input_field.get_suggested_answers_parsed()" t-as="suggestion">
                            <div class="badge rounded-pill bg-info text-dark text-wrap text-start lh-sm border border-info cursor-pointer btn-suggestion p-2" style="cursor: pointer; max-width: 100%; white-space: normal;" t-att-data-value="suggestion" t-att-data-target="input_field.field_key">
                                <t t-esc="suggestion"/>
                            </div>
                        </t>
                    </div>
                </div>
            </t>

            <!-- Irrelevant Reason Field (Hidden by default) -->
            <div t-att-id="'irrelevant_' + input_field.field_key" class="mt-3 p-2 bg-warning bg-opacity-10 border border-warning rounded d-none irrelevant-box">
                <label class="form-label text-warning-emphasis small">Why is this irrelevant?</label>
                <div class="d-flex gap-2">
                    <input type="text" t-att-name="'irrelevant_reason_' + input_field.field_key" class="form-control form-control-sm" placeholder="e.g. We don't need this feature..."/>
                    <button type="button" class="btn btn-sm btn-outline-secondary btn-irrelevant-cancel" t-att-data-target="'irrelevant_' + input_field.field_key">Cancel</button>
                </div>
                <input type="hidden" t-att-name="'is_irrelevant_' + input_field.field_key" value="false" class="irrelevant-flag"/>
            </div>

            <!-- Custom Answer Field (Hidden by default) -->
            <div t-att-id="'custom_answer_' + input_field.field_key" class="mt-3 p-2 bg-info bg-opacity-10 border border-info rounded d-none custom-answer-box">
                <label class="form-label text-info-emphasis small">Custom Answer</label>
                <div class="d-flex gap-2">
                    <input type="text" t-att-name="'custom_answer_val_' + input_field.field_key" class="form-control form-control-sm" placeholder="Type your answer here..."/>
                    <button type="button" class="btn btn-sm btn-outline-secondary btn-custom-answer-cancel" t-att-data-target="'custom_answer_' + input_field.field_key">Cancel</button>
                </div>
                <input type="hidden" t-att-name="'has_custom_answer_' + input_field.field_key" value="false" class="custom-answer-flag"/>
            </div>
        </div>
    </template>

    <template id="portal_rfp_interface" name="AI Interviewer Interface">
        <t t-call="portal.portal_layout">
            <t t-call="project_rfp_ai.rfp_theme_styles"/>
            <div class="container py-4 rfp-portal-wrapper">
                
                <!-- USE COMPONENT -->
                <t t-call="project_rfp_ai.rfp_loading_overlay_component"/>

                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card shadow-lg border-0">
                            <!-- Header with gold accent -->
                            <div class="card-header bg-white py-4" style="border-bottom: 3px solid var(--rfp-gold);">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="bg-rfp-gold-light rounded-circle p-3">
                                        <i class="fa fa-comments fa-lg text-rfp-gold"/>
                                    </div>
                                    <div>
                                        <h3 class="mb-1" t-field="rfp_project.name"/>
                                        <span class="text-muted small">AI Analyst is gathering requirements...</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body p-4">

                                <!-- Progress Bar -->
                                <t t-set="raw_score" t-value="rfp_project.get_context_data().get('analysis_meta', {}).get('completeness_score', 0)"/>
                                <t t-set="completeness" t-value="raw_score if raw_score > 1 else raw_score * 100"/>
                                <div t-if="rfp_project.current_stage == 'initialized' and rfp_project.ai_context_blob" class="mb-4">
                                    <div class="d-flex justify-content-between mb-2">
                                        <small class="text-muted">Analysis Progress</small>
                                        <small class="fw-semibold text-rfp-gold"><t t-esc="int(completeness)"/>%</small>
                                    </div>
                                    <div class="progress" style="height: 12px;">
                                        <div class="progress-bar" role="progressbar" t-att-style="'width: ' + str(int(completeness)) + '%'" t-att-aria-valuenow="int(completeness)" aria-valuemin="0" aria-valuemax="100"/>
                                    </div>
                                </div>

                                <!-- Status Alerts -->
                                <t t-set="ai_status" t-value="rfp_project.get_context_data().get('analysis_meta', {}).get('status')"/>

                                <div t-if="ai_status == 'rate_limit'" class="alert alert-warning mb-3">
                                    <h4 class="alert-heading h5"><i class="fa fa-clock-o"/> System Busy (Rate Limit)</h4>
                                    <p class="mb-0">The AI service is experiencing high traffic. Please wait 30 seconds before retrying.</p>
                                    <form t-attf-action="/rfp/next_step/#{rfp_project.id}" method="post" class="mt-2">
                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                        <button type="submit" class="btn btn-sm btn-warning">Retry Now</button>
                                    </form>
                                </div>

                                <div t-if="ai_status == 'error'" class="alert alert-danger mb-3">
                                    <h4 class="alert-heading h5"><i class="fa fa-exclamation-triangle"/> Analysis Interrupted</h4>
                                    <p class="mb-2">Reference: <t t-esc="rfp_project.get_context_data().get('research_notes', 'Unknown Error')"/></p>
                                    <a t-attf-href="/rfp/interface/#{rfp_project.id}" class="btn btn-sm btn-outline-danger">Retry Analysis</a>
                                </div>

                                <!-- Questions Form -->
                                <form t-attf-action="/rfp/next_step/#{rfp_project.id}" method="post">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                                    <t t-if="questions_to_answer and ai_status != 'rate_limit'">
                                        <div class="alert alert-info border-0 mb-4">
                                            <i class="fa fa-info-circle me-2"/> The AI has analyzed your project and needs a few more details.
                                        </div>
                                        
                                        <t t-foreach="questions_to_answer" t-as="input_field">
                                            <t t-call="project_rfp_ai.portal_rfp_input_field"/>
                                        </t>

                                        <div class="d-grid mt-4">
                                            <button type="submit" class="btn btn-rfp-gold btn-lg">
                                                <i class="fa fa-arrow-right me-2"/> Submit Answers &amp; Continue
                                            </button>
                                        </div>
                                    </t>
                                    
                                    <!-- Checkpoint -->
                                    <t t-elif="not questions_to_answer and ai_status != 'rate_limit' and not is_generating">
                                        <div class="text-center py-4">
                                            <div class="mb-3">
                                                <i class="fa fa-check-circle fa-4x text-rfp-gold"/>
                                            </div>
                                            <h4>Analysis Checkpoint</h4>
                                            <p class="text-muted">All current questions have been answered. Proceed to the next phase.</p>
                                            <button type="submit" class="btn btn-rfp-gold btn-lg mt-2">
                                                <i class="fa fa-magic me-2"/> Generate Next Round
                                            </button>
                                        </div>
                                    </t>
                                </form>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- PHASE 2: UNIFIED PROCESSING STATUS -->
    <template id="portal_rfp_processing" name="RFP Processing Status">
        <t t-call="portal.portal_layout">
            <t t-call="project_rfp_ai.rfp_theme_styles"/>
            <div class="container py-5 rfp-portal-wrapper">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card shadow-lg border-0 text-center">
                            <div class="card-body p-5">
                                <!-- Header with spinning icon -->
                                <div class="mb-4">
                                    <div class="d-inline-block position-relative">
                                        <i class="fa fa-cog fa-4x text-rfp-gold fa-spin"/>
                                    </div>
                                </div>
                                <h2 class="mb-3">AI Architect is Working...</h2>
                                <p class="text-muted mb-5">We're autonomously building your RFP document. This involves structuring, writing, and designing.</p>

                                <!-- Steps Visual -->
                                <div class="mb-5">
                                    <ul class="list-group list-group-flush text-start" id="rfp_step_list">
                                        <li class="list-group-item d-flex justify-content-between align-items-center border-0 py-3" id="step_structure">
                                            <span><i class="fa fa-sitemap me-3 text-rfp-gold"/> 1. Designing Structure</span>
                                            <span class="badge rounded-pill bg-secondary status-badge">Pending</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center border-0 py-3" id="step_content">
                                            <span><i class="fa fa-pencil me-3 text-rfp-gold"/> 2. Writing Content</span>
                                            <span class="badge rounded-pill bg-secondary status-badge">Pending</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center border-0 py-3" id="step_images">
                                            <span><i class="fa fa-image me-3 text-rfp-gold"/> 3. Drawing Diagrams</span>
                                            <span class="badge rounded-pill bg-secondary status-badge">Pending</span>
                                        </li>
                                    </ul>
                                </div>

                                <div class="progress mb-3" style="height: 16px;">
                                    <div id="rfp_generation_progress" class="progress-bar" role="progressbar" style="width: 0%" t-att-data-project-id="rfp_project.id">
                                        0%
                                    </div>
                                </div>
                                <p id="rfp_status_text" class="small text-muted mb-0">Initializing...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- PHASE 3: UNIFIED EDITOR (SPA) -->
    <template id="portal_rfp_unified_editor" name="RFP Unified Editor">
        <t t-call="portal.portal_layout">
            <t t-call="project_rfp_ai.rfp_theme_styles"/>
            <!-- Load Quill.js -->
            <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet"/>
            <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

            <div class="container-fluid py-4 rfp-portal-wrapper">
                
                <!-- Toolbar with gold accent -->
                <div class="rfp-toolbar d-flex justify-content-between align-items-center mb-4 sticky-top p-3" style="z-index: 1000; top: 60px;">
                    <div class="d-flex align-items-center gap-3">
                        <i class="fa fa-file-text-o fa-lg text-rfp-gold"/>
                        <h4 class="mb-0" t-field="rfp_project.name"/>
                        <span t-if="rfp_project.current_stage == 'completed'" class="badge bg-rfp-gold">Ready</span>
                        <span t-if="rfp_project.current_stage == 'document_locked'" class="badge bg-dark"><i class="fa fa-lock me-1"/> Locked</span>
                    </div>
                    
                    <div class="d-flex gap-2">
                         <a t-attf-href="/rfp/download/word/#{rfp_project.id}" class="btn btn-rfp-gold-outline">
                            <i class="fa fa-file-word-o me-1"/> Word
                        </a>
                        <button onclick="window.print()" class="btn btn-outline-secondary">
                            <i class="fa fa-print me-1"/> Print
                        </button>
                        
                        <div class="vr mx-1"></div>

                        <t t-if="rfp_project.current_stage != 'document_locked'">
                            <button id="btn_unified_save" class="btn btn-rfp-gold" t-att-data-project-id="rfp_project.id">
                                <i class="fa fa-save me-1"/> Save
                            </button>
                            <button id="btn_toggle_lock" class="btn btn-outline-secondary" t-att-data-project-id="rfp_project.id" data-locked="true">
                                <i class="fa fa-lock me-1"/> Lock
                            </button>
                        </t>
                        <t t-else="">
                            <button id="btn_toggle_lock" class="btn btn-rfp-gold-outline" t-att-data-project-id="rfp_project.id" data-locked="false">
                                <i class="fa fa-unlock me-1"/> Unlock
                            </button>
                        </t>
                        
                        <div class="vr mx-1"></div>
                        
                        <!-- Publish Buttons -->
                        <t t-if="rfp_project.is_published">
                            <a t-attf-href="/rfp/proposals/#{rfp_project.id}" class="btn btn-outline-info">
                                <i class="fa fa-inbox me-1"/> Proposals
                                <t t-if="rfp_project.published_id.proposal_count > 0">
                                    <span class="badge bg-info ms-1" t-esc="rfp_project.published_id.proposal_count"/>
                                </t>
                            </a>
                            <button id="btn_publish" class="btn btn-success" t-att-data-project-id="rfp_project.id" t-att-data-is-update="'true'">
                                <i class="fa fa-refresh me-1"/> Update
                            </button>
                            <button id="btn_unpublish" class="btn btn-outline-danger" t-att-data-project-id="rfp_project.id">
                                <i class="fa fa-eye-slash me-1"/> Unpublish
                            </button>
                        </t>
                        <t t-else="">
                            <button id="btn_publish" class="btn btn-success" t-att-data-project-id="rfp_project.id">
                                <i class="fa fa-globe me-1"/> Publish
                            </button>
                        </t>
                    </div>
                </div>

                <!-- Public URL Bar (when published) -->
                <t t-if="rfp_project.is_published">
                    <div class="alert alert-success d-flex align-items-center mb-4 py-2">
                        <i class="fa fa-link me-2"></i>
                        <span class="me-2"><strong>Public URL:</strong></span>
                        <input type="text" id="editor_public_url" class="form-control form-control-sm me-2" style="max-width: 400px;"
                            t-att-value="rfp_project.published_id.get_public_url()" readonly="readonly"/>
                        <button type="button" class="btn btn-sm btn-success me-2" id="btn_copy_editor_url">
                            <i class="fa fa-copy me-1"></i> Copy
                        </button>
                        <a t-att-href="rfp_project.published_id.get_public_url()" target="_blank" class="btn btn-sm btn-outline-success">
                            <i class="fa fa-external-link me-1"></i> Open
                        </a>
                    </div>
                </t>

                <div class="row">
                    <!-- Main Editor Area -->
                    <div class="col-12">
                        <div id="rfp_unified_container" class="bg-light p-3 rounded">
                            
                            <!-- Draggable List -->
                            <div id="rfp_section_list" class="d-flex flex-column gap-4">
                                <t t-foreach="rfp_project.document_section_ids.sorted('sequence')" t-as="section">
                                    <div class="card shadow-sm rfp-section-block" t-att-data-section-id="section.id" draggable="true">
                                        <!-- Header -->
                                        <div class="card-header bg-white d-flex align-items-center gap-3 p-3 handle" style="cursor: move;">
                                            <i class="fa fa-bars text-muted fa-lg"/>
                                            <input type="text" class="form-control form-control-lg fw-bold border-0 bg-transparent section-title-input" t-att-value="section.section_title" placeholder="Section Title"/>
                                            <div class="ms-auto d-flex gap-1">
                                                <button class="btn btn-sm btn-light border btn-ai-edit-section" style="min-width: 55px;" t-att-data-section-id="section.id" title="Edit with AI" t-att-disabled="rfp_project.current_stage == 'document_locked'">
                                                    <i class="fa fa-magic text-primary"/> AI
                                                </button>
                                                <button class="btn btn-sm text-danger btn-delete-section" t-att-disabled="rfp_project.current_stage == 'document_locked'">
                                                    <i class="fa fa-trash"/>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Content Body -->
                                        <div class="card-body p-0">
                                            <div class="rfp-quill-editor bg-white border-bottom" style="min-height: 200px;" t-att-id="'editor_' + str(section.id)">
                                                <t t-out="section.content_html"/>
                                            </div>
                                        </div>

                                        <!-- Images Footer -->
                                        <div class="card-footer bg-light p-3">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <h6 class="text-muted small text-uppercase fw-bold mb-0">Diagrams &amp; Visuals</h6>
                                                <button class="btn btn-sm btn-outline-primary btn-upload-diagram-trigger" t-att-data-section-id="section.id" t-att-disabled="rfp_project.current_stage == 'document_locked'">
                                                    <i class="fa fa-upload"/> Add Image
                                                </button>
                                                <input type="file" class="d-none rfp-diagram-upload-input" accept="image/*" t-att-data-section-id="section.id"/>
                                            </div>
                                            
                                            <div class="row g-3 diagrams-container" t-att-id="'diagrams-container-' + str(section.id)">
                                                <t t-if="section.diagram_ids">
                                                    <t t-foreach="section.diagram_ids" t-as="diagram">
                                                        <div class="col-md-4 col-sm-6 diagram-wrapper" t-att-data-diagram-id="diagram.id">
                                                            <div class="card h-100 border-0 shadow-sm diagram-card">
                                                                <div class="position-relative">
                                                                    <img t-if="diagram.image_file" t-att-src="'/web/image/rfp.section.diagram/%s/image_file' % diagram.id" class="card-img-top object-fit-cover" style="height: 150px; cursor: pointer;"/>
                                                                    <div t-else="" class="card-img-top bg-secondary text-white d-flex align-items-center justify-content-center" style="height: 150px;">
                                                                        <i class="fa fa-image fa-2x"/>
                                                                    </div>
                                                                    
                                                                    <!-- Overlay Actions -->
                                                                    <div class="position-absolute top-0 end-0 p-2 d-flex gap-1" t-if="rfp_project.current_stage != 'document_locked'">
                                                                        <button class="btn btn-sm btn-light text-primary shadow-sm btn-ai-edit-diagram" t-att-data-diagram-id="diagram.id" title="Edit with AI">
                                                                            <i class="fa fa-magic"/>
                                                                        </button>
                                                                        <button class="btn btn-sm btn-light text-danger shadow-sm btn-delete-diagram" t-att-data-diagram-id="diagram.id" title="Delete Image">
                                                                            <i class="fa fa-trash"/>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                                <div class="card-body p-2">
                                                                    <p class="card-text small text-muted text-truncate mb-0" t-att-title="diagram.description">
                                                                        <t t-esc="diagram.description"/>
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </t>
                                                </t>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </div>
                            
                            <!-- Add Section Button -->
                            <div class="text-center mt-4">
                                <button id="btn_add_section" class="btn btn-outline-secondary dashed-border w-50 py-3">
                                    <i class="fa fa-plus-circle fa-lg mb-2"/><br/>
                                    Add New Section
                                </button>
                            </div>

                        </div>
                    </div>
                </div>
                
                <!-- Hidden Template for New Sections (cloned by JS) -->
                <div id="section_template_clone" class="d-none">
                    <div class="card shadow-sm rfp-section-block mb-4" data-section-id="0" draggable="true">
                        <!-- Header -->
                        <div class="card-header bg-white d-flex align-items-center gap-3 p-3 handle" style="cursor: move;">
                            <i class="fa fa-bars text-muted fa-lg"/>
                            <input type="text" class="form-control form-control-lg fw-bold border-0 bg-transparent section-title-input" value="" placeholder="Section Title"/>
                            <button class="btn btn-sm text-danger btn-delete-section ms-auto">
                                <i class="fa fa-trash"/>
                            </button>
                        </div>
        
                        <!-- Content Body -->
                        <div class="card-body p-0">
                            <div class="rfp-quill-editor bg-white border-bottom" style="min-height: 200px;"></div>
                        </div>
        
                        <!-- Images Footer -->
                        <div class="card-footer bg-light p-3">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="text-muted small text-uppercase fw-bold mb-0">Diagrams &amp; Visuals</h6>
                                <button class="btn btn-sm btn-outline-primary btn-upload-diagram-trigger">
                                    <i class="fa fa-upload"/> Add Image
                                </button>
                                <input type="file" class="d-none rfp-diagram-upload-input" accept="image/*"/>
                            </div>
                            <div class="row g-3 diagrams-container"></div>
                        </div>
                    </div>
                </div>
        
                <!-- Lock Confirmation Modal -->
                <div class="modal fade" id="modal_lock_confirm" tabindex="-1" role="dialog">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header border-0 pb-0">
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body text-center pt-0">
                                <div class="mb-3">
                                    <i class="fa fa-lock fa-4x text-warning"></i>
                                </div>
                                <h4>Lock Document?</h4>
                                <p class="text-muted">
                                    Locking the document will prevent further edits. you can unlock it later but it is better to finish everything before locking.
                                </p>
                            </div>
                            <div class="modal-footer justify-content-center border-0">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary px-4" id="btn_confirm_lock_action">Yes, Lock it!</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upload Diagram Modal -->
                <div class="modal fade" id="modal_upload_diagram" tabindex="-1" role="dialog">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Add Diagram</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="form_upload_diagram">
                                    <input type="hidden" id="upload_section_id" name="section_id"/>
                                    <div class="mb-3">
                                        <label class="form-label">Title <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="upload_diagram_title" name="title" required="required"/>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Description</label>
                                        <textarea class="form-control" id="upload_diagram_desc" name="description" rows="3" required="required"></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Image File <span class="text-danger">*</span></label>
                                        <input type="file" class="form-control" id="upload_diagram_file" name="image_file" accept="image/*" required="required"/>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" id="btn_save_diagram">Upload</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Delete Confirmation Modal -->
                <div class="modal fade" id="modal_delete_confirm" tabindex="-1" role="dialog">
                    <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
                        <div class="modal-content">
                            <div class="modal-header border-0 pb-0">
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body text-center pt-0">
                                <div class="mb-3">
                                    <i class="fa fa-trash fa-3x text-danger"></i>
                                </div>
                                <h5 id="delete_confirm_title">Delete Item?</h5>
                                <p class="text-muted small" id="delete_confirm_message">This action cannot be undone.</p>
                                <input type="hidden" id="delete_target_type"/>
                                <input type="hidden" id="delete_target_id"/>
                            </div>
                            <div class="modal-footer justify-content-center border-0 pt-0">
                                <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-danger btn-sm px-4" id="btn_confirm_delete">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Image Viewer Modal -->
                <div class="modal fade" id="modal_image_viewer" tabindex="-1" role="dialog">
                    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                        <div class="modal-content bg-dark">
                            <div class="modal-header border-0">
                                <h6 class="modal-title text-white" id="image_viewer_title">Image Preview</h6>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body text-center p-2">
                                <img id="image_viewer_img" src="" class="img-fluid rounded" style="max-height: 70vh;" alt="Preview"/>
                            </div>
                            <div class="modal-footer border-0 justify-content-center">
                                <a id="image_viewer_download" href="" download="" class="btn btn-light">
                                    <i class="fa fa-download"></i> Download
                                </a>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Edit Modal -->
                <div class="modal fade" id="modal_ai_edit" tabindex="-1" role="dialog">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="fa fa-magic text-primary"></i> Edit with AI
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <p class="text-muted small" id="ai_edit_context_label">Describe how you want to modify the content:</p>
                                <textarea class="form-control" id="ai_edit_prompt" rows="4" placeholder="E.g., Make it more formal, add bullet points, focus on security aspects..."></textarea>
                                <input type="hidden" id="ai_edit_type"/>
                                <input type="hidden" id="ai_edit_target_id"/>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" id="btn_submit_ai_edit">
                                    <i class="fa fa-magic"></i> Apply AI Edit
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notification Modal (Success/Error) -->
                <div class="modal fade" id="modal_notification" tabindex="-1" role="dialog">
                    <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
                        <div class="modal-content">
                            <div class="modal-body text-center py-4">
                                <div class="mb-3">
                                    <i id="notification_icon" class="fa fa-3x"></i>
                                </div>
                                <h5 id="notification_title">Notification</h5>
                                <p class="text-muted small mb-0" id="notification_message"></p>
                            </div>
                            <div class="modal-footer justify-content-center border-0 pt-0">
                                <button type="button" class="btn btn-primary btn-sm px-4" data-bs-dismiss="modal">OK</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Publish Success Modal -->
                <div class="modal fade" id="modal_publish_success" tabindex="-1" role="dialog">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-body text-center py-5">
                                <i class="fa fa-check-circle fa-4x text-success mb-4"></i>
                                <h4 id="publish_success_title">Published!</h4>
                                <p class="text-muted mb-4">Your RFP is now available at the following URL:</p>
                                <div class="input-group mb-3">
                                    <input type="text" id="publish_success_url" class="form-control text-center" readonly="readonly"/>
                                    <button class="btn btn-rfp-gold" type="button" id="btn_copy_publish_url">
                                        <i class="fa fa-copy me-1"/> Copy URL
                                    </button>
                                </div>
                                <a id="link_open_public" href="#" target="_blank" class="text-primary small">
                                    <i class="fa fa-external-link me-1"/> Open in new tab
                                </a>
                            </div>
                            <div class="modal-footer justify-content-center border-0 pt-0">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="window.location.reload()">Close &amp; Refresh</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Unpublish Confirm Modal -->
                <div class="modal fade" id="modal_unpublish_confirm" tabindex="-1" role="dialog">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-body text-center py-5">
                                <i class="fa fa-eye-slash fa-4x text-warning mb-4"></i>
                                <h4>Take Down RFP?</h4>
                                <p class="text-muted">The public URL will no longer be accessible.<br/>Existing proposals will be preserved.</p>
                            </div>
                            <div class="modal-footer justify-content-center border-0">
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-danger" id="btn_confirm_unpublish">
                                    <i class="fa fa-eye-slash me-1"/> Yes, Unpublish
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>


    </template>



    <template id="portal_rfp_document" name="Generated RFP Document">
        <t t-call="portal.portal_layout">
            <t t-call="project_rfp_ai.rfp_theme_styles"/>
            <style>
                .rfp-section-content h3 {
                    font-size: 1.25rem !important;
                    color: var(--rfp-dark);
                    margin-top: 1.5rem;
                }
                .rfp-document-title {
                    position: relative;
                    display: inline-block;
                }
                .rfp-document-title::after {
                    content: '';
                    position: absolute;
                    bottom: -10px;
                    left: 50%;
                    transform: translateX(-50%);
                    width: 80px;
                    height: 4px;
                    background: var(--rfp-gold-gradient);
                    border-radius: 2px;
                }
                @media print {
                    header, footer, #top_menu, .o_footer, .breadcrumb, .btn-group, .text-end, .btn, .rfp-doc-actions {
                        display: none !important;
                    }
                    body {
                        background-color: white !important;
                        padding-top: 0 !important;
                    }
                    .container {
                        max-width: 100% !important; 
                        width: 100% !important; 
                        margin: 0 !important; 
                        padding: 0 !important;
                    }
                    .card {
                        box-shadow: none !important; 
                        border: none !important;
                    }
                }
            </style>
            <div class="container py-5 rfp-portal-wrapper">
                <div class="row">
                    <!-- Action Buttons -->
                    <div class="col-12 mb-4 rfp-doc-actions">
                        <div class="d-flex justify-content-end gap-2">
                            <button onclick="window.print()" class="btn btn-outline-secondary">
                                <i class="fa fa-print me-1"/> Print PDF
                            </button>
                            <a t-attf-href="/rfp/download/word/#{rfp_project.id}" class="btn btn-rfp-gold-outline">
                                <i class="fa fa-file-word-o me-1"/> Word
                            </a>
                            <a t-attf-href="/rfp/revert_to_edit/#{rfp_project.id}" class="btn btn-rfp-gold">
                                <i class="fa fa-pencil me-1"/> Edit
                            </a>
                        </div>
                    </div>
                    
                    <!-- Document Card -->
                    <div class="col-12">
                        <div class="card shadow-lg border-0">
                            <div class="card-body p-5">
                                <div class="text-center mb-5">
                                    <h1 class="display-5 rfp-document-title" t-field="rfp_project.name"/>
                                </div>
                                <hr class="my-4" style="border-color: var(--rfp-gold-light);"/>

                                <t t-foreach="rfp_project.document_section_ids.sorted(lambda s: s.sequence)" t-as="section">
                                    <div class="mb-5">
                                        <h2 class="mb-3" style="color: var(--rfp-dark); border-left: 4px solid var(--rfp-gold); padding-left: 1rem;" t-field="section.section_title"/>
                                        <div class="rfp-section-content ps-4" t-field="section.content_html"/>
                                        
                                        <!-- Attached Diagrams -->
                                        <t t-if="section.diagram_ids">
                                            <div class="mt-4 ps-4">
                                                <t t-foreach="section.diagram_ids" t-as="diagram">
                                                    <figure class="text-center mb-4" t-if="diagram.image_file">
                                                        <img t-att-src="'/web/image/rfp.section.diagram/%s/image_file' % diagram.id" class="img-fluid rounded shadow-sm" style="max-height: 500px; border: 2px solid var(--rfp-gold-light);"/>
                                                        <figcaption class="mt-2 text-muted fst-italic">
                                                            <strong t-esc="diagram.title"/>
                                                        </figcaption>
                                                    </figure>
                                                </t>
                                            </div>
                                        </t>
                                    </div>
                                    <hr t-if="not section_last" style="border-color: var(--rfp-gold-light);"/>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Integrate Mermaid.js for Diagrams -->
            <script type="module">
                import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
                mermaid.initialize({startOnLoad: true});
            </script>
        </t>
    </template>

    <!-- ============ PUBLISHED RFP PUBLIC VIEW ============ -->
    <template id="portal_rfp_public_view" name="Public RFP View">
        <t t-call="website.layout">
            <t t-call="project_rfp_ai.rfp_theme_styles"/>
            <div class="container py-5 rfp-portal-wrapper">
                <!-- Header -->
                <div class="text-center mb-5">
                    <h1 class="display-5 rfp-document-title" t-esc="published.title"/>
                    <p class="text-muted mt-4" t-if="published.description" t-esc="published.description"/>
                    <div class="mt-4">
                        <a t-attf-href="/rfp/public/#{published.uuid}/submit" class="btn btn-rfp-gold btn-lg">
                            <i class="fa fa-paper-plane me-2"/> Submit Your Proposal
                        </a>
                    </div>
                </div>
                
                <hr class="my-4" style="border-color: var(--rfp-gold-light);"/>
                
                <!-- Content Sections -->
                <div class="card shadow-lg border-0">
                    <div class="card-body p-5">
                        <t t-foreach="sections" t-as="section">
                            <div class="mb-5">
                                <h2 class="mb-3" style="color: var(--rfp-dark); border-left: 4px solid var(--rfp-gold); padding-left: 1rem;" t-esc="section.title"/>
                                <div class="rfp-section-content ps-4" t-raw="section.content_html"/>
                                
                                <!-- Diagrams -->
                                <t t-if="section.diagram_ids">
                                    <div class="mt-4 ps-4">
                                        <t t-foreach="section.diagram_ids" t-as="diagram">
                                            <figure class="text-center mb-4" t-if="diagram.image_file">
                                                <img t-att-src="'/web/image/rfp.published.diagram/%s/image_file' % diagram.id" class="img-fluid rounded shadow-sm" style="max-height: 500px; border: 2px solid var(--rfp-gold-light);"/>
                                                <figcaption class="mt-2 text-muted fst-italic" t-esc="diagram.title"/>
                                            </figure>
                                        </t>
                                    </div>
                                </t>
                            </div>
                            <hr t-if="not section_last" style="border-color: var(--rfp-gold-light);"/>
                        </t>
                    </div>
                </div>
                
                <!-- CTA -->
                <div class="text-center mt-5">
                    <a t-attf-href="/rfp/public/#{published.uuid}/submit" class="btn btn-rfp-gold btn-lg">
                        <i class="fa fa-paper-plane me-2"/> Submit Your Proposal
                    </a>
                </div>
            </div>
        </t>
    </template>

    <!-- ============ PROPOSAL SUBMISSION FORM ============ -->
    <template id="portal_rfp_proposal_form" name="Proposal Submission Form">
        <t t-call="website.layout">
            <t t-call="project_rfp_ai.rfp_theme_styles"/>
            <div class="container py-5 rfp-portal-wrapper">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card shadow-lg border-0">
                            <div class="card-body p-5">
                                <div class="text-center mb-4">
                                    <i class="fa fa-paper-plane fa-3x text-rfp-gold mb-3"/>
                                    <h2>Submit Your Proposal</h2>
                                    <p class="text-muted">For: <strong t-esc="published.title"/></p>
                                </div>
                                
                                <hr class="my-4" style="border-color: var(--rfp-gold-light);"/>
                                
                                <form t-attf-action="/rfp/public/#{published.uuid}/submit" method="post" enctype="multipart/form-data">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    
                                    <h5 class="mb-3"><i class="fa fa-building me-2 text-rfp-gold"/> Company Information</h5>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Company Name <span class="text-danger">*</span></label>
                                            <input type="text" name="company_name" class="form-control" required="required"/>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Website</label>
                                            <input type="url" name="website" class="form-control" placeholder="https://..."/>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">LinkedIn URL</label>
                                        <input type="url" name="linkedin" class="form-control" placeholder="https://linkedin.com/company/..."/>
                                    </div>
                                    
                                    <hr class="my-4"/>
                                    
                                    <h5 class="mb-3"><i class="fa fa-user me-2 text-rfp-gold"/> Contact Person</h5>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Contact Name <span class="text-danger">*</span></label>
                                            <input type="text" name="contact_person" class="form-control" required="required"/>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Email <span class="text-danger">*</span></label>
                                            <input type="email" name="email" class="form-control" required="required"/>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Phone</label>
                                        <input type="tel" name="phone" class="form-control"/>
                                    </div>
                                    
                                    <hr class="my-4"/>
                                    
                                    <h5 class="mb-3"><i class="fa fa-file-pdf-o me-2 text-rfp-gold"/> Proposal Document</h5>
                                    <div class="mb-3">
                                        <label class="form-label">Upload Proposal (PDF)</label>
                                        <input type="file" name="proposal_file" class="form-control" accept=".pdf,.doc,.docx"/>
                                    </div>
                                    <div class="mb-4">
                                        <label class="form-label">Additional Notes</label>
                                        <textarea name="notes" class="form-control" rows="4" placeholder="Any additional information..."/>
                                    </div>
                                    
                                    <div class="d-grid">
                                        <button type="submit" class="btn btn-rfp-gold btn-lg">
                                            <i class="fa fa-send me-2"/> Submit Proposal
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- ============ PROPOSAL SUCCESS ============ -->
    <template id="portal_rfp_proposal_success" name="Proposal Submitted">
        <t t-call="website.layout">
            <t t-call="project_rfp_ai.rfp_theme_styles"/>
            <div class="container py-5 rfp-portal-wrapper">
                <div class="row justify-content-center">
                    <div class="col-lg-6 text-center">
                        <div class="card shadow-lg border-0">
                            <div class="card-body p-5">
                                <i class="fa fa-check-circle fa-5x text-success mb-4"/>
                                <h2 class="mb-3">Proposal Submitted!</h2>
                                <p class="text-muted">Thank you for your interest. Your proposal has been received and will be reviewed by the team.</p>
                                <hr class="my-4"/>
                                <a t-attf-href="/rfp/public/#{published.uuid}" class="btn btn-rfp-gold-outline">
                                    <i class="fa fa-arrow-left me-2"/> Back to RFP
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- ============ PROPOSALS LIST (Owner View) ============ -->
    <template id="portal_rfp_proposals_list" name="View Proposals">
        <t t-call="portal.portal_layout">
            <t t-call="project_rfp_ai.rfp_theme_styles"/>
            <div class="container py-4 rfp-portal-wrapper">
                <!-- Header -->
                <div class="rfp-hero mb-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h2 class="mb-2">Proposals for <t t-esc="project.name"/></h2>
                            <p class="mb-0">
                                <t t-esc="len(proposals)"/> proposal(s) received
                                <span class="mx-2">|</span>
                                Published: <t t-esc="published.published_date" t-options="{'widget': 'date'}"/>
                            </p>
                        </div>
                        <div class="col-md-4 text-md-end mt-3 mt-md-0">
                            <a t-attf-href="/rfp/edit/#{project.id}" class="btn btn-rfp-gold">
                                <i class="fa fa-arrow-left me-2"/> Back to Editor
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Public URL -->
                <div class="alert alert-info mb-4 d-flex align-items-center">
                    <strong class="me-2">Public URL:</strong>
                    <input type="text" id="proposals_public_url" class="form-control form-control-sm me-2" style="max-width: 400px;"
                        t-att-value="published.get_public_url()" readonly="readonly"/>
                    <button type="button" class="btn btn-sm btn-outline-primary me-2" id="btn_copy_proposals_url">
                        <i class="fa fa-copy me-1"></i> Copy
                    </button>
                    <a t-att-href="published.get_public_url()" target="_blank" class="btn btn-sm btn-primary">
                        <i class="fa fa-external-link me-1"></i> Open
                    </a>
                </div>
                
                <!-- Proposals Table -->
                <t t-if="proposals">
                    <div class="card shadow-lg border-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Company</th>
                                        <th>Contact</th>
                                        <th>Submitted</th>
                                        <th>Status</th>
                                        <th>Proposal</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="proposals" t-as="proposal">
                                        <tr>
                                            <td>
                                                <strong t-esc="proposal.company_name"/>
                                                <br/>
                                                <small t-if="proposal.website">
                                                    <a t-att-href="proposal.website" target="_blank" class="text-muted"><i class="fa fa-globe"/> Website</a>
                                                </small>
                                            </td>
                                            <td>
                                                <t t-esc="proposal.contact_person"/>
                                                <br/>
                                                <small class="text-muted" t-esc="proposal.email"/>
                                            </td>
                                            <td t-esc="proposal.submitted_date" t-options="{'widget': 'datetime'}"/>
                                            <td>
                                                <span t-attf-class="badge bg-{{ 'success' if proposal.status == 'accepted' else ('warning' if proposal.status in ['reviewing', 'shortlisted'] else ('danger' if proposal.status == 'rejected' else 'secondary')) }}" t-esc="proposal.status"/>
                                            </td>
                                            <td>
                                                <a t-attf-href="/rfp/proposal/#{proposal.id}" class="btn btn-sm btn-rfp-gold me-1">
                                                    <i class="fa fa-eye"></i> View
                                                </a>
                                                <a t-if="proposal.proposal_file" t-attf-href="/web/content/rfp.proposal/#{proposal.id}/proposal_file/#{proposal.proposal_filename}" class="btn btn-sm btn-outline-primary" download="">
                                                    <i class="fa fa-download"></i>
                                                </a>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </t>
                <t t-else="">
                    <div class="text-center py-5">
                        <i class="fa fa-inbox fa-4x text-muted mb-3" style="opacity: 0.3;"/>
                        <h4 class="text-muted">No proposals yet</h4>
                        <p class="text-muted">Share the public URL to start receiving proposals</p>
                    </div>
                </t>
            </div>
        </t>
    </template>

    <!-- ============ PROPOSAL DETAIL VIEW ============ -->
    <template id="portal_rfp_proposal_detail" name="Proposal Detail">
        <t t-call="portal.portal_layout">
            <t t-call="project_rfp_ai.rfp_theme_styles"/>
            <div class="container py-4 rfp-portal-wrapper">
                <!-- Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2 class="mb-1">
                            <i class="fa fa-file-text-o text-rfp-gold me-2"></i>
                            Proposal from <t t-esc="proposal.company_name"/>
                        </h2>
                        <p class="text-muted mb-0">
                            For: <strong t-esc="project.name"/>
                            <span class="mx-2">|</span>
                            Submitted: <t t-esc="proposal.submitted_date" t-options="{'widget': 'datetime'}"/>
                        </p>
                    </div>
                    <div>
                        <a t-attf-href="/rfp/proposals/#{project.id}" class="btn btn-outline-secondary">
                            <i class="fa fa-arrow-left me-1"></i> Back to Proposals
                        </a>
                    </div>
                </div>

                <div class="row">
                    <!-- Left Column: Info -->
                    <div class="col-lg-4 mb-4">
                        <!-- Status Card -->
                        <div class="card shadow-sm border-0 mb-4">
                            <div class="card-header bg-rfp-gold text-white">
                                <h6 class="mb-0"><i class="fa fa-info-circle me-2"></i> Status</h6>
                            </div>
                            <div class="card-body text-center py-4">
                                <span t-attf-class="badge fs-5 bg-{{ 'success' if proposal.status == 'accepted' else ('warning' if proposal.status in ['reviewing', 'shortlisted'] else ('danger' if proposal.status == 'rejected' else 'secondary')) }}" 
                                      style="text-transform: capitalize;" t-esc="proposal.status"/>
                            </div>
                        </div>

                        <!-- Company Info -->
                        <div class="card shadow-sm border-0 mb-4">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fa fa-building me-2"></i> Company</h6>
                            </div>
                            <div class="card-body">
                                <h5 t-esc="proposal.company_name"/>
                                <t t-if="proposal.website">
                                    <p class="mb-2">
                                        <a t-att-href="proposal.website" target="_blank" class="text-primary">
                                            <i class="fa fa-globe me-1"></i> <t t-esc="proposal.website"/>
                                        </a>
                                    </p>
                                </t>
                                <t t-if="proposal.linkedin">
                                    <p class="mb-0">
                                        <a t-att-href="proposal.linkedin" target="_blank" class="text-primary">
                                            <i class="fa fa-linkedin me-1"></i> LinkedIn Profile
                                        </a>
                                    </p>
                                </t>
                            </div>
                        </div>

                        <!-- Contact Info -->
                        <div class="card shadow-sm border-0 mb-4">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fa fa-user me-2"></i> Contact Person</h6>
                            </div>
                            <div class="card-body">
                                <h6 t-esc="proposal.contact_person"/>
                                <p class="mb-2">
                                    <a t-att-href="'mailto:' + proposal.email" class="text-primary">
                                        <i class="fa fa-envelope me-1"></i> <t t-esc="proposal.email"/>
                                    </a>
                                </p>
                                <t t-if="proposal.phone">
                                    <p class="mb-0">
                                        <a t-att-href="'tel:' + proposal.phone" class="text-primary">
                                            <i class="fa fa-phone me-1"></i> <t t-esc="proposal.phone"/>
                                        </a>
                                    </p>
                                </t>
                            </div>
                        </div>

                        <!-- Notes -->
                        <t t-if="proposal.notes">
                            <div class="card shadow-sm border-0">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fa fa-sticky-note me-2"></i> Additional Notes</h6>
                                </div>
                                <div class="card-body">
                                    <p class="mb-0" style="white-space: pre-wrap;" t-esc="proposal.notes"/>
                                </div>
                            </div>
                        </t>
                    </div>

                    <!-- Right Column: Document Viewer -->
                    <div class="col-lg-8">
                        <div class="card shadow-sm border-0">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0"><i class="fa fa-file-pdf-o me-2"></i> Proposal Document</h6>
                                <t t-if="proposal.proposal_file">
                                    <a t-attf-href="/web/content/rfp.proposal/#{proposal.id}/proposal_file/#{proposal.proposal_filename}" 
                                       class="btn btn-sm btn-rfp-gold" download="">
                                        <i class="fa fa-download me-1"></i> Download
                                    </a>
                                </t>
                            </div>
                            <div class="card-body p-0">
                                <t t-if="proposal.proposal_file">
                                    <!-- PDF Viewer -->
                                    <t t-if="file_type == 'pdf'">
                                        <iframe t-attf-src="/web/content/rfp.proposal/#{proposal.id}/proposal_file/#{proposal.proposal_filename}#toolbar=1" 
                                                style="width: 100%; height: 80vh; border: none;"/>
                                    </t>
                                    <!-- Image Viewer -->
                                    <t t-elif="file_type == 'image'">
                                        <div class="text-center p-4">
                                            <img t-attf-src="/web/content/rfp.proposal/#{proposal.id}/proposal_file/#{proposal.proposal_filename}" 
                                                 class="img-fluid rounded shadow" style="max-height: 70vh;"/>
                                        </div>
                                    </t>
                                    <!-- Other File Types -->
                                    <t t-else="">
                                        <div class="text-center py-5">
                                            <i class="fa fa-file fa-4x text-muted mb-3" style="opacity: 0.5;"></i>
                                            <h5>Preview not available</h5>
                                            <p class="text-muted" t-esc="proposal.proposal_filename"/>
                                            <a t-attf-href="/web/content/rfp.proposal/#{proposal.id}/proposal_file/#{proposal.proposal_filename}" 
                                               class="btn btn-rfp-gold" download="">
                                                <i class="fa fa-download me-1"></i> Download to View
                                            </a>
                                        </div>
                                    </t>
                                </t>
                                <t t-else="">
                                    <div class="text-center py-5">
                                        <i class="fa fa-file-o fa-4x text-muted mb-3" style="opacity: 0.3;"></i>
                                        <h5 class="text-muted">No document attached</h5>
                                        <p class="text-muted">This proposal was submitted without a file.</p>
                                    </div>
                                </t>
                            </div>
                        </div>
                        
                        <!-- AI Analysis Section -->
                        <div class="card shadow-sm border-0 mt-4">
                            <div class="card-header d-flex justify-content-between align-items-center bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <h6 class="mb-0 text-white"><i class="fa fa-magic me-2"></i> AI Analysis</h6>
                                <t t-if="proposal.analysis_status == 'done'">
                                    <span class="badge bg-success">Ready</span>
                                </t>
                                <t t-elif="proposal.analysis_status == 'processing'">
                                    <span class="badge bg-warning"><i class="fa fa-spinner fa-spin me-1"></i> Processing</span>
                                </t>
                                <t t-elif="proposal.analysis_status == 'failed'">
                                    <span class="badge bg-danger">Failed</span>
                                </t>
                                <t t-else="">
                                    <span class="badge bg-secondary">Pending</span>
                                </t>
                            </div>
                            <div class="card-body">
                                <!-- Processing State -->
                                <t t-if="proposal.analysis_status in ['pending', 'processing']">
                                    <div class="text-center py-5">
                                        <i class="fa fa-cog fa-spin fa-3x text-muted mb-3"></i>
                                        <h5>AI Analysis in Progress</h5>
                                        <p class="text-muted">Our AI is analyzing this proposal against your RFP requirements.<br/>This typically takes 1-2 minutes.</p>
                                        <button class="btn btn-outline-primary btn-sm" onclick="window.location.reload()">
                                            <i class="fa fa-refresh me-1"></i> Check Status
                                        </button>
                                    </div>
                                </t>
                                
                                <!-- Failed State -->
                                <t t-elif="proposal.analysis_status == 'failed'">
                                    <div class="text-center py-4">
                                        <i class="fa fa-exclamation-triangle fa-3x text-danger mb-3"></i>
                                        <h5>Analysis Failed</h5>
                                        <p class="text-muted">An error occurred during analysis. Please try again later.</p>
                                    </div>
                                </t>
                                
                                <!-- Analysis Ready -->
                                <t t-elif="analysis">
                                    <!-- Summary & Score Row -->
                                    <div class="row mb-4">
                                        <div class="col-md-4 text-center">
                                            <div class="border rounded p-3">
                                                <h2 t-attf-class="mb-0 text-{{ 'success' if analysis.get('coverage_score', 0) >= 70 else ('warning' if analysis.get('coverage_score', 0) >= 50 else 'danger') }}">
                                                    <t t-esc="analysis.get('coverage_score', 0)"/>%
                                                </h2>
                                                <small class="text-muted">Coverage Score</small>
                                            </div>
                                        </div>
                                        <div class="col-md-4 text-center">
                                            <div class="border rounded p-3">
                                                <h4 t-attf-class="mb-0 text-{{ 'success' if analysis.get('overall_rating') == 'Excellent' else ('primary' if analysis.get('overall_rating') == 'Good' else ('warning' if analysis.get('overall_rating') == 'Fair' else 'danger')) }}" 
                                                    t-esc="analysis.get('overall_rating', 'N/A')"/>
                                                <small class="text-muted">Overall Rating</small>
                                            </div>
                                        </div>
                                        <div class="col-md-4 text-center">
                                            <div class="border rounded p-3">
                                                <h4 t-attf-class="mb-0 text-{{ 'success' if analysis.get('recommendation') == 'Shortlist' else ('warning' if analysis.get('recommendation') == 'Review' else 'danger') }}" 
                                                    t-esc="analysis.get('recommendation', 'N/A')"/>
                                                <small class="text-muted">AI Recommendation</small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Summary -->
                                    <div class="alert alert-light mb-4">
                                        <strong>Summary:</strong> <t t-esc="analysis.get('summary', '')"/>
                                    </div>
                                    
                                    <!-- Strengths & Weaknesses -->
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <h6 class="text-success"><i class="fa fa-thumbs-up me-2"></i> Strengths</h6>
                                            <ul class="list-unstyled">
                                                <t t-foreach="analysis.get('strengths', [])" t-as="item">
                                                    <li class="mb-2 p-2 bg-success-subtle rounded">
                                                        <strong t-esc="item.get('title', '')"/>
                                                        <t t-if="item.get('impact')">
                                                            <span t-attf-class="badge bg-{{ 'success' if item.get('impact') == 'High' else ('warning' if item.get('impact') == 'Medium' else 'secondary') }} ms-1" t-esc="item.get('impact')"/>
                                                        </t>
                                                        <br/><small class="text-muted" t-esc="item.get('description', '')"/>
                                                    </li>
                                                </t>
                                                <t t-if="not analysis.get('strengths')">
                                                    <li class="text-muted"><em>No strengths identified</em></li>
                                                </t>
                                            </ul>
                                        </div>
                                        <div class="col-md-6">
                                            <h6 class="text-danger"><i class="fa fa-thumbs-down me-2"></i> Weaknesses</h6>
                                            <ul class="list-unstyled">
                                                <t t-foreach="analysis.get('weaknesses', [])" t-as="item">
                                                    <li class="mb-2 p-2 bg-danger-subtle rounded">
                                                        <strong t-esc="item.get('title', '')"/>
                                                        <t t-if="item.get('severity')">
                                                            <span t-attf-class="badge bg-{{ 'danger' if item.get('severity') == 'Critical' else ('warning' if item.get('severity') == 'Major' else 'secondary') }} ms-1" t-esc="item.get('severity')"/>
                                                        </t>
                                                        <br/><small class="text-muted" t-esc="item.get('description', '')"/>
                                                    </li>
                                                </t>
                                                <t t-if="not analysis.get('weaknesses')">
                                                    <li class="text-muted"><em>No weaknesses identified</em></li>
                                                </t>
                                            </ul>
                                        </div>
                                    </div>
                                    
                                    <!-- Insights -->
                                    <t t-if="analysis.get('insights')">
                                        <h6><i class="fa fa-lightbulb-o me-2"></i> Key Insights</h6>
                                        <div class="row mb-4">
                                            <t t-foreach="analysis.get('insights', [])" t-as="insight">
                                                <div class="col-md-6 mb-2">
                                                    <div class="border-start border-3 border-info ps-3 py-1">
                                                        <small class="badge bg-info mb-1" t-esc="insight.get('category', '')"/>
                                                        <p class="mb-0 small" t-esc="insight.get('finding', '')"/>
                                                    </div>
                                                </div>
                                            </t>
                                        </div>
                                    </t>
                                    
                                    <!-- Risk Assessment -->
                                    <t t-if="analysis.get('risk_assessment')">
                                        <h6><i class="fa fa-warning me-2"></i> Risk Assessment</h6>
                                        <div class="alert mb-4" t-attf-class="alert-{{ 'success' if analysis.get('risk_assessment', {}).get('level') == 'Low' else ('warning' if analysis.get('risk_assessment', {}).get('level') == 'Medium' else 'danger') }}">
                                            <strong>Risk Level: <t t-esc="analysis.get('risk_assessment', {}).get('level', 'Unknown')"/></strong>
                                            <ul class="mb-0 mt-2">
                                                <t t-foreach="analysis.get('risk_assessment', {}).get('factors', [])" t-as="factor">
                                                    <li t-esc="factor"/>
                                                </t>
                                            </ul>
                                        </div>
                                    </t>
                                    
                                    <!-- Recommendation Reason -->
                                    <t t-if="analysis.get('recommendation_reason')">
                                        <div class="alert alert-secondary">
                                            <strong><i class="fa fa-comment me-2"></i> Recommendation Reason:</strong>
                                            <p class="mb-0 mt-1" t-esc="analysis.get('recommendation_reason')"/>
                                        </div>
                                    </t>
                                    
                                    <!-- Questions for Vendor -->
                                    <t t-if="analysis.get('questions_for_vendor')">
                                        <h6><i class="fa fa-question-circle me-2"></i> Suggested Questions for Vendor</h6>
                                        <ol class="text-muted">
                                            <t t-foreach="analysis.get('questions_for_vendor', [])" t-as="question">
                                                <li t-esc="question"/>
                                            </t>
                                        </ol>
                                    </t>
                                </t>
                                
                                <!-- No File Case -->
                                <t t-elif="not proposal.proposal_file">
                                    <div class="text-center py-4">
                                        <i class="fa fa-file-o fa-3x text-muted mb-3"></i>
                                        <h5 class="text-muted">No Document to Analyze</h5>
                                        <p class="text-muted">AI analysis requires a proposal document.</p>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

</odoo>
